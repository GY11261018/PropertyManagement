<!DOCTYPE html>
<html>
<head>

	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">

	<title>Payment List</title>
	
	<!-- Favicons -->
	<link href="../assets/image/favicon.png" rel="icon">
	
	<!-- Google Fonts -->
	<link href="../assets/css/googlefont.css" rel="stylesheet">
	
	<!-- Vendor CSS Files -->
	<link href="../assets/vendor/aos/aos.css" rel="stylesheet">
	<link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">

	<!-- Bootstrap Font Icon CSS -->
    <link rel="stylesheet" href="../assets/vendor/bootstrap-icons/bootstrap-font-icon.css">

	<link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap3.css">
	<link rel="stylesheet" href="../assets/css/fontawesome.css">
	<link rel="stylesheet" href="../assets/css/propertyListstyle.css">
	
    <script type="text/javascript" src="../assets/js/googleapis.js"></script>
	<script src="../assets/js/jsviewer.js"></script>
	<link rel="stylesheet" href="../assets/css/cloudflare4.7.0.css">
	
	<script type="text/javascript" language="javascript" src="../assets/js/deleteLocalStorage.js"></script> 
	
</head>

<body id="page-top">
	<!-- ======= Header ======= -->
	<header id="header" class="fixed-top ">
		<div class="container d-flex align-items-center">

			<h1 class="logo me-auto"><a href="dashboard.html">Property</a></h1>

			<nav id="navbar" class="navbar">
				<ul>
					<li><a class="nav-link" href="dashboard.html"><span class="glyphicon glyphicon-dashboard"></span>Dashboard</a></li>
					<li><a class="nav-link" href="propertyList.html"><span class="glyphicon glyphicon-home"></span>Property</a></li>
					<li><a class="nav-link active" href="paymentList.html"><span class="glyphicon glyphicon-usd"></span>Payment</a></li>
					<li><a class="nav-link" href="mapList.html"><span class="glyphicon glyphicon-map-marker"></span>Map</a></li>
					<li><a class="nav-link" href="profile.html"><span class="glyphicon glyphicon-user"></span>Profile</a></li>
					<li><a class="logout" href="../assets/php/logout.php?logout" onclick="deleteLocalStorage();"><span class="glyphicon glyphicon-log-out"></span>Logout</a></li>
				</ul>
				<i class="bi bi-list mobile-nav-toggle"></i>
			</nav><!-- .navbar -->

		</div>
	</header>
	<!-- End Header -->
	
    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">


                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
					<div class = "heading">
						<div class = "col-sm-11 py-3"><h3 class="mt-2 text-gray-800"><img src="../assets/image/money.png" class="table-icon" alt="table-svg"/>Payment List Table</h3></div>
						<div class = "col-sm-1 py-2"><a href="addpayment.html" class="addnew"><button type = "button" class="btn btn-primary m-2">Add New Payment</button></a></div>
					</div>
				</div>

					<!-- Card -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h4 class="m-0 pb-4 font-weight-bold text-black">Payment List</h4>
								<div class = "d-flex">
								<h5>Select Number Of Rows</h5>
									<div class="form-group col-xs-3 col-sm-2 col-md-2 col-lg-1">
										<!----------Show Numbers Of Rows---------->
										<select class = "form-control" name="state" id="maxRows">
											<option value="5000">Show All Rows</option>
											<option value="10">10</option>
											<option value="25">25</option>
											<option value="50">50</option>
											<option value="75">75</option>
											<option value="100">100</option>
										</select>
									</div>
								</div>
						</div>
						
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="myTable" cellspacing="0">
                                    <thead>
										<tr id = "mybtn" style = "background-color: #37517E; color: white;">
                                            <th>Property Name<button class='btn btn-outline-light text-info fa fa-arrows-v' onclick="sortAlp(0)"></button></th>
                                            <th>Client Name<button class='btn btn-outline-light text-info fa fa-arrows-v' onclick="sortAlp(1)"></button></th>
											<th>Rental Price (RM)<button class='btn btn-outline-light text-info fa fa-arrows-v' onclick="sortNum(2)"></button></th>
                                            <th>Total Price (RM)<button class='btn btn-outline-light text-info fa fa-arrows-v' onclick="sortNum(3)"></button></th>
                                            <th>Payment Status<button class='btn btn-outline-light text-info fa fa-arrows-v' onclick="sortAlp(4)"></a></button></th>
											<th style = "text-align: center; padding-bottom: 15px;">View</th>
											<th style = "text-align: center; padding-bottom: 15px;">Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentList">
									
									</tbody>
									
									<div id="myModal">
									
									</div>
									
                                </table>
								
								<!-------Start Pagination--------->
								<div class='pagination-container' >
									<nav>
										<ul class="pagination">
											<li data-page="prev" >
												<span> < <span class="sr-only">(current)</span></span>
											</li>
												<!--	Here the JS Function Will Add the Rows -->
											<li data-page="next" id="prev">
												<span> > <span class="sr-only">(current)</span></span>
											</li>
										</ul>
									</nav>
								</div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->
	
	<!-- ======= Footer ======= -->
	<footer id="footer">
		<div class="container footer-bottom clearfix"></div>
	</footer>
	<!-- End Footer -->
	
	<!-- Back To Top -->
	<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

	<!-- Vendor JS Files -->
	<script src="../assets/vendor/aos/aos.js"></script>
	<script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
	<script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>

	<!-- Template Main JS File -->
	<script src="../assets/js/main.js"></script>


<script>

$(document).ready(function() {
	
	if(localStorage.getItem("response") == "1") {
		displayPaymentList();
	}
	else {
		alert("Not authorized to access.");
		window.location.href = '../index.html';
	}
	
});

function displayPaymentList() {
	// Check if the user has login
	$.ajax({
		url: '../assets/php/session.php',
		dataType: 'json',
		success: function(data){
		
			// If admin has login
			if(data.response == "1"){
				$.ajax({
					url: '../assets/php/paymentList.php',
					dataType: 'json',
					success: function(data){
					
						var paymentHtml = ``;
						var modalHtml = ``;
						
						for(let i=0; i<data.length; i++) {
							
							var payment_id = data[i].payment_id;
							var property_name = data[i].property_name;
							var client_name = data[i].client_name;
							var rental_price = data[i].rental_price;
							var total_amount = data[i].total_amount;
							var payment_status = data[i].payment_status;
							
							paymentHtml +=
							`<tr>
								<td>${property_name}</td>
								<td>${client_name}</td>
								<td>${rental_price}</td>
								<td>${total_amount}</td>
								<td>${payment_status}</td>
								<td class='viewbtn' align ="center"><a href="updatePayment.html?edit=${payment_id}" class='fa fa-eye' style="color: white;"></a></td>
								<td class='deletebtn' align ="center"><button type="button" data-toggle="modal" data-target="#myModal${payment_id}" class='ubtn btn bg-danger'><a href="#" class='fa fa-trash' style="color: white;"></a></button></td>
							</tr>`;
							
							modalHtml +=
							`<!-- Modal (Delete) -->
							<div class="modal fade" id="myModal${payment_id}" tabindex="-1" role="dialog" aria-hidden="true">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h4 class="modal-title"><b>Delete Confirmation</b></h4>
											<button type="button" class="close" data-dismiss="modal">&times;</button>
										</div>
										<div class="modal-body">
											<p>Are you sure you want to delete this payment?</p>
										</div>
										<div class="modal-footer">
											<a onclick="deletePayment(${payment_id})" class='fa fa-trash' style="color: white;"><button type="button" class="btn btn-danger">Delete</button></a>
											<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
										</div>
									</div>
								</div>
							</div><!-- End Modal -->`;
						}
						
						$('#paymentList').html(paymentHtml);
						$('#myModal').html(modalHtml);
					}
				});
			}
			else {
				alert("Please login before proceed!");
				window.location.href = '../index.html';
			}
		}
	});
}


function deletePayment(id) {

	var payment_id = id;
	
	$.ajax({
		type: 'POST',
		url: '../assets/php/updatePayment.php',
		data: {payment_id: payment_id},
		dataType: 'json',
		success: function(data) {
			window.location.href = data;
		}
	});
}

<!-------------------------------------Sorting the table hearder--------------------------->
<!------------Sort table data alphabetically------------>
function sortAlp(n) {
	var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
	table = document.getElementById("myTable");
	switching = true;
	
	dir = "asc"; 
	
	while (switching) {
		
		switching = false;
		rows = table.rows;
		
		for (i = 1; i < (rows.length - 1); i++) {
			
			shouldSwitch = false;
			
			x = rows[i].getElementsByTagName("TD")[n];
			y = rows[i + 1].getElementsByTagName("TD")[n];
			
		if (dir == "asc") {
			if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
			
			shouldSwitch= true;
			break;
			}
		} 
		
		else if (dir == "desc") {
        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
          
          shouldSwitch = true;
          break;
			}
		}
    }
	
    if (shouldSwitch) {
      
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      
      switchcount ++;      
    }
	
	else {
      
      if (switchcount == 0 && dir == "asc") {
        dir = "desc";
        switching = true;
		}
    }
  }
}

<!------------Sort table data numerically------------>
function sortNum(n) {
	var table, rows, switching, i, x, y, shouldSwitching, dir, switchcounting = 0;
	table = document.getElementById("myTable");
	switching = true;
	//Set the sorting direction to ascending:
	dir = "asc"; 
	/*Make a loop that will continue until
	no switching has been done:*/
	while (switching) {
		//start by saying: no switching is done:
		switching = false;
		rows = table.rows;
		/*Loop through all table rows (except the
		first, which contains table headers):*/
		for (i = 1; i < (rows.length - 1); i++) {
			//start by saying there should be no switching:
			shouldSwitching = false;
			/*Get the two elements you want to compare,
			one from current row and one from the next:*/
			x = rows[i].getElementsByTagName("TD")[n];
			y = rows[i + 1].getElementsByTagName("TD")[n];
			/*check if the two rows should switch place,
			based on the direction, asc or desc:*/
		if (dir == "asc") {
			if (Number(x.innerHTML) > Number(y.innerHTML)) {
			//if so, mark as a switch and break the loop:
			shouldSwitching= true;
			break;
			}
		} 
		
		else if (dir == "desc") {
        if (Number(x.innerHTML) < Number(y.innerHTML)) {
          //if so, mark as a switch and break the loop:
          shouldSwitching = true;
          break;
			}
		}
		}
    
	if (shouldSwitching) {
		/*If a switch has been marked, make the switch
		and mark that a switch has been done:*/
		rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
		switching = true;
		//Each time a switch is done, increase this count by 1:
		switchcounting ++;      
    }
	
	else {
		/*If no switching has been done AND the direction is "asc",
		set the direction to "desc" and run the while loop again.*/
		if (switchcounting == 0 && dir == "asc") {
			dir = "desc";
			switching = true;
		}
    }
  }
}


<!------------Add active class to the current sorting button (highlight it)------------>
var header = document.getElementById("mybtn");
var btns = header.getElementsByClassName("btn");
for (var i = 0; i < btns.length; i++) {
	btns[i].addEventListener("click", function() {
	var current = document.getElementsByClassName("active");
	current[0].className = current[0].className.replace(" active", "");
	this.className += " active";
	});
}

getPagination('#myTable');


function getPagination(table) {
	var lastPage = 1;

	$('#maxRows')
		.on('change', function(evt) {
		//$('.paginationprev').html('');						// reset pagination

     lastPage = 1;
		$('.pagination')
			.find('li')
			.slice(1, -1)
			.remove();
		var trnum = 0; // reset tr counter
		var maxRows = parseInt($(this).val()); // get Max Rows from select option

		if (maxRows == 5000) {
			$('.pagination').hide();
		} else {
			$('.pagination').show();
		}

		var totalRows = $(table + ' tbody tr').length; // numbers of rows
		$(table + ' tr:gt(0)').each(function() {
			// each TR in  table and not the header
			trnum++; // Start Counter
			if (trnum > maxRows) {
			// if tr number gt maxRows

			$(this).hide(); // fade it out
		}
        if (trnum <= maxRows) {
			$(this).show();
		} // else fade in Important in case if it ..
		}); //  was fade out to fade it in
		if (totalRows > maxRows) {
		// if tr total rows gt max rows option
		var pagenum = Math.ceil(totalRows / maxRows); // ceil total(rows/maxrows) to get ..
		//	numbers of pages
		for (var i = 1; i <= pagenum; ) {
			// for each page append pagination li
			$('.pagination #prev')
            .before(
              '<li data-page="' +
                i +
                '">\
								  <span>' +
                i++ +
                '<span class="sr-only">(current)</span></span>\
								</li>'
            )
            .show();
        } // end for i
		} // end if row count > max rows
		$('.pagination [data-page="1"]').addClass('active'); // add active class to the first li
		$('.pagination li').on('click', function(evt) {
		// on click each page
		evt.stopImmediatePropagation();
        evt.preventDefault();
        var pageNum = $(this).attr('data-page'); // get it's number

        var maxRows = parseInt($('#maxRows').val()); // get Max Rows from select option

        if (pageNum == 'prev') {
          if (lastPage == 1) {
            return;
			}
          pageNum = --lastPage;
        }
        if (pageNum == 'next') {
          if (lastPage == $('.pagination li').length - 2) {
            return;
			}
          pageNum = ++lastPage;
        }

        lastPage = pageNum;
        var trIndex = 0; // reset tr counter
        $('.pagination li').removeClass('active'); // remove active class from all li
        $('.pagination [data-page="' + lastPage + '"]').addClass('active'); // add active class to the clicked
        // $(this).addClass('active');					// add active class to the clicked
	  	limitPagging();
        $(table + ' tr:gt(0)').each(function() {
			// each tr in table not the header
			trIndex++; // tr index counter
			// if tr index gt maxRows*pageNum or lt maxRows*pageNum-maxRows fade if out
			if (
				trIndex > maxRows * pageNum ||
				trIndex <= maxRows * pageNum - maxRows
			) {
				$(this).hide();
			} else {
				$(this).show();
			} //else fade in
        }); // end of for each tr in table
      }); // end of on click pagination list
	  limitPagging();
    })
    .val(5000)
    .change();

  // end of on select change

  // END OF PAGINATION
}

function limitPagging(){
	// alert($('.pagination li').length)

	if($('.pagination li').length > 7 ){
			if( $('.pagination li.active').attr('data-page') <= 3 ){
			$('.pagination li:gt(50)').hide();
			$('.pagination li:lt(50)').show();
			$('.pagination [data-page="next"]').show();
		}if ($('.pagination li.active').attr('data-page') > 3){
			$('.pagination li:gt(0)').hide();
			$('.pagination [data-page="next"]').show();
			for( let i = ( parseInt($('.pagination li.active').attr('data-page'))  -2 )  ; i <= ( parseInt($('.pagination li.active').attr('data-page'))  + 2 ) ; i++ ){
				$('.pagination [data-page="'+i+'"]').show();

			}

		}
	}
}

</script>


</body>

</html>